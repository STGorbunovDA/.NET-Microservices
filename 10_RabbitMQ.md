# Внедряем RabbitMQ Messaging

* ***RabbitMQ*** - это брокер сообщений, который используется для обмена информацией между различными компонентами или приложениями в распределенной системе. Он реализует протокол AMQP (Advanced Message Queuing Protocol) и предоставляет надежную и гибкую систему для обмена сообщениями между отправителями и получателями.

* ***RabbitMQ*** основан на модели очередей сообщений, где отправители (производители) помещают сообщения в очередь, а получатели (потребители) забирают их из очереди. Это обеспечивает асинхронную коммуникацию между компонентами системы и позволяет им взаимодействовать независимо от доступности других компонентов.
        
 ![RabbitMQ_34](https://github.com/STGorbunovDA/.NET-Microservices/blob/dev/img/34.png)

 ![RabbitMQ_35](https://github.com/STGorbunovDA/.NET-Microservices/blob/dev/img/35.png)

 * Преимущества ***RabbitMQ*** включают гарантированную доставку сообщений, масштабируемость, надежность и поддержку различных шаблонов коммуникации, таких как точка-точка, издатель-подписчик и маршрутизация событий.
 *  Он широко используется в различных сценариях, включая микросервисные архитектуры, обработку событий, асинхронную обработку задач, управление очередями задач и интеграцию между приложениями и системами.

* Зайдём в папку **K8S** и создадим манифест ***rabbitmq-depl.yaml:***
    * Смотри коммиты: [Create RabbitMQ Deployment](https://github.com/STGorbunovDA/.NET-Microservices/commit/6de65c3927c5e301b1b22a897d4214a4b7c2930f) и 
     [сhange](https://github.com/STGorbunovDA/.NET-Microservices/commit/539085b4a219387fe3e7cd2c320a776b2970d1f3)
    * ***rabbitmq-depl.yaml*** представляет собой манифесты *Kubernetes* для развертывания ***RabbitMQ*** (брокера сообщений) в кластере с использованием ***Deployment*** и создания сервисов (*Service*) для доступа к ***RabbitMQ***.
    * Первый манифест определяет *Deployment* (развертывание) с именем "*rabbitmq*-*depl*". Он использует образ ***RabbitMQ*** с поддержкой управления и определяет один реплику контейнера. *Deployment* включает в себя контейнер ***RabbitMQ***, который открывает порты 15672 (управление) и 5672 (передача сообщений) для взаимодействия.
    * Следующие два манифеста определяют два сервиса (*rabbitmq-clusterip-srv* и *rabbitmq-loadbalancer*). Сервис *rabbitmq-clusterip-srv* типа *ClusterIP* используется для доступа к ***RabbitMQ*** изнутри кластера ***Kubernetes*** и маршрутизирует трафик на порты 15672 и 5672 контейнера ***RabbitMQ***.
    * Сервис *rabbitmq*-*loadbalancer* типа *LoadBalancer* используется для создания балансировщика нагрузки, который позволяет внешним клиентам обращаться к ***RabbitMQ***. Он также маршрутизирует трафик на порты 15672 и 5672 контейнера ***RabbitMQ***.
    * Таким образом, эти манифесты определяют поды с ***RabbitMQ*** и сервисы для обеспечения доступа к ним как внутри кластера ***Kubernetes***, так и извне.
    * Выполним развёртывание контейнера ***RabbitMQ*** (кластера):
        * *kubectl apply -f **rabbitmq-depl.yaml***
    * Запускаем команды:
        *kubectl get services*, должно получится:

        ![RabbitMQ_37](https://github.com/STGorbunovDA/.NET-Microservices/blob/dev/img/37.png)

        *kubectl get pods и* после того как ***Kubernetes*** скачает образ с DockerHub*  должно получится:

         ![RabbitMQ_38](https://github.com/STGorbunovDA/.NET-Microservices/blob/dev/img/38.png)
    * Далее в браузере вводим localhost:15672
        * Вводим логин и пароль **quest***
    * Визуализируем что должно получится в ***Kubernetes***: 

        ![RabbitMQ_36](https://github.com/STGorbunovDA/.NET-Microservices/blob/dev/img/36.png)



    
